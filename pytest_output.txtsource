============================= test session starts ==============================
platform darwin -- Python 3.13.3, pytest-8.3.5, pluggy-1.6.0 -- /Users/jamiemeredith/Projects/ytdatahub/venv/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/jamiemeredith/Projects/ytdatahub
configfile: pytest.ini
testpaths: tests
plugins: Faker-37.3.0, mock-3.14.0, cov-6.1.1, requests-mock-1.12.1
collecting ... collected 350 items

tests/integration/api/test_api_db_comparison_view.py::test_api_db_comparison_module_level_discovery PASSED [  0%]
tests/integration/api/test_channel_refresh_video_data.py::TestChannelRefreshUI::test_process_video_data PASSED [  0%]
tests/integration/api/test_channel_refresh_video_data.py::TestChannelRefreshUI::test_fix_missing_views_function PASSED [  0%]
tests/integration/api/test_channel_refresh_video_data.py::TestChannelRefreshUI::test_ensure_views_data_legacy_function PASSED [  1%]
tests/integration/api/test_video_with_empty_api_response.py::test_video_with_empty_api_response PASSED [  1%]
tests/integration/database/test_database_integration.py::TestDatabaseIntegration::test_api_to_database_workflow PASSED [  1%]
tests/integration/database/test_database_integration.py::TestDatabaseIntegration::test_database_connections_cleanup PASSED [  2%]
tests/integration/database/test_database_integration.py::TestDatabaseIntegration::test_channel_data_integrity PASSED [  2%]
tests/integration/database/test_database_integration.py::TestDatabaseIntegration::test_all_channels_have_uploads_playlist_id PASSED [  2%]
tests/integration/workflow/test_add_vs_refresh_parity.py::test_add_vs_refresh_channel_data_parity FAILED [  2%]
tests/integration/workflow/test_minimal.py::test_minimal PASSED          [  3%]
tests/integration/workflow/test_queue_status.py::test_queue_status_implementation PASSED [  3%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_extracts_video_metrics PASSED [  3%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_handles_missing_video_metrics PASSED [  4%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_handles_video_service_error PASSED [  4%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_updates_existing_videos PASSED [  4%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_handles_quota_exceeded PASSED [  4%]
tests/services/youtube/test_data_collection.py::test_collect_channel_data_handles_mixed_video_metrics PASSED [  5%]
tests/services/youtube/test_data_collection.py::test_new_collection_workflow_no_deltas PASSED [  5%]
tests/services/youtube/test_data_collection.py::test_update_channel_workflow_with_deltas PASSED [  5%]
tests/services/youtube/test_data_collection.py::test_workflow_debug_log_on_error PASSED [  6%]
tests/services/youtube/test_data_collection.py::test_update_channel_response_includes_deltas_and_logs PASSED [  6%]
tests/services/youtube/test_data_collection.py::test_fetch_videos_returns_videos_and_logs PASSED [  6%]
tests/services/youtube/test_data_collection.py::test_update_channel_response_includes_top_level_delta PASSED [  6%]
tests/services/youtube/test_data_collection.py::test_update_channel_delta_videos_non_empty PASSED [  7%]
tests/services/youtube/test_data_collection.py::test_fetch_all_videos_returns_all PASSED [  7%]
tests/services/youtube/test_data_collection.py::test_debug_logs_and_response_data_present PASSED [  7%]
tests/services/youtube/test_data_collection.py::test_fetch_videos_returns_non_empty_list PASSED [  8%]
tests/services/youtube/test_data_collection.py::test_get_basic_channel_info_all_input_types ERROR [  8%]
tests/services/youtube/test_video_service.py::test_collect_channel_videos_extracts_metrics FAILED [  8%]

==================================== ERRORS ====================================
________ ERROR at setup of test_get_basic_channel_info_all_input_types _________
file /Users/jamiemeredith/Projects/ytdatahub/tests/services/youtube/test_data_collection.py, line 462
  def test_get_basic_channel_info_all_input_types(youtube_service, monkeypatch):
E       fixture 'youtube_service' not found
>       available fixtures: _session_faker, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, class_mocker, cov, data_collection, doctest_namespace, faker, mock_api, mock_comment_service, mock_video_service, mocker, module_mocker, monkeypatch, no_cover, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, requests_mock, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/jamiemeredith/Projects/ytdatahub/tests/services/youtube/test_data_collection.py:462
=================================== FAILURES ===================================
___________________ test_add_vs_refresh_channel_data_parity ____________________

    def test_add_vs_refresh_channel_data_parity():
        print("[TEST DEBUG] Entered test_add_vs_refresh_channel_data_parity")
        print("[TEST DEBUG] test_add_vs_refresh_channel_data_parity starting")
        # Setup mock service and API
        service, mock_api, mock_db = YouTubeTestFactory.create_mock_service()
    
        # Create channel data with videos and comments
        channel_data = YouTubeTestFactory.create_channel_data(include_videos=True, video_count=3, include_comments=True)
        YouTubeTestFactory.configure_mock_api_for_workflow(mock_api, channel_data=channel_data, video_data=channel_data, comment_data=channel_data)
    
        print("[TEST DEBUG] test_add_vs_refresh_channel_data_parity setup complete, running main test logic")
    
        # Simulate 'add new channel' flow (full collection)
        add_steps = {
            'channel': {'fetch': True},
            'videos': {'fetch': True, 'max': 3},
            'comments': {'fetch': True, 'max': 3},
            'save': False
        }
        print("[TEST DEBUG] About to call collect_channel_data")
        add_results, add_final = YouTubeTestFactory.create_test_steps_pipeline(service, mock_api, mock_db, steps_config=add_steps)
        print("[TEST DEBUG] collect_channel_data call returned")
        # Reset video pagination counter before refresh flow
        YouTubeTestFactory.reset_video_pagination_counter(mock_api)
        # Simulate 'refresh channel' flow (full refresh)
        refresh_steps = {
            'channel': {'fetch': True},
            'videos': {'fetch': True, 'max': 3},
            'comments': {'fetch': True, 'max': 3},
            'save': False
        }
        print("[TEST DEBUG] About to call collect_channel_data")
        refresh_results, refresh_final = YouTubeTestFactory.create_test_steps_pipeline(service, mock_api, mock_db, steps_config=refresh_steps)
        print("[TEST DEBUG] collect_channel_data call returned")
    
        # Compare video data for parity
        add_videos = add_results['videos']['video_id']
        refresh_videos = refresh_results['videos']['video_id']
        assert len(add_videos) == len(refresh_videos)
        for v_add, v_refresh in zip(add_videos, refresh_videos):
            assert v_add['video_id'] == v_refresh['video_id']
            assert v_add['views'] == v_refresh['views']
            assert v_add['comment_count'] == v_refresh['comment_count']
            # If statistics dict is present, check viewCount and commentCount
            if 'statistics' in v_add and 'statistics' in v_refresh:
                assert v_add['statistics'].get('viewCount', v_add['views']) == v_refresh['statistics'].get('viewCount', v_refresh['views'])
                assert v_add['statistics'].get('commentCount', v_add['comment_count']) == v_refresh['statistics'].get('commentCount', v_refresh['comment_count'])
    
        # Compare comments for parity
        for v_add, v_refresh in zip(add_videos, refresh_videos):
            if 'comments' in v_add and 'comments' in v_refresh:
                assert len(v_add['comments']) == len(v_refresh['comments'])
                for c_add, c_refresh in zip(v_add['comments'], v_refresh['comments']):
                    assert c_add['comment_id'] == c_refresh['comment_id']
                    assert c_add['comment_text'] == c_refresh['comment_text']
                    assert c_add['comment_author'] == c_refresh['comment_author']
    
        # Ensure all videos have view and comment counts and check for edge cases
        for v in add_videos + refresh_videos:
            assert 'views' in v, f"Missing 'views' in video: {v}"
            assert 'comment_count' in v, f"Missing 'comment_count' in video: {v}"
            assert isinstance(v['views'], (int, float)), f"'views' is not numeric: {v['views']} in video: {v}"
            assert isinstance(v['comment_count'], (int, float)), f"'comment_count' is not numeric: {v['comment_count']} in video: {v}"
            assert v['views'] >= 0, f"'views' is negative: {v['views']} in video: {v}"
            assert v['comment_count'] >= 0, f"'comment_count' is negative: {v['comment_count']} in video: {v}"
            # If statistics dict is present, check types and values
            if 'statistics' in v:
                stats = v['statistics']
                if 'viewCount' in stats:
                    assert isinstance(stats['viewCount'], (int, float, str)), f"'viewCount' is not numeric or string: {stats['viewCount']}"
                    # Accept string numbers as valid (YouTube API sometimes returns strings)
                    if isinstance(stats['viewCount'], str):
                        assert stats['viewCount'].isdigit(), f"'viewCount' string is not digit: {stats['viewCount']}"
                if 'commentCount' in stats:
                    assert isinstance(stats['commentCount'], (int, float, str)), f"'commentCount' is not numeric or string: {stats['commentCount']}"
                    if isinstance(stats['commentCount'], str):
                        assert stats['commentCount'].isdigit(), f"'commentCount' string is not digit: {stats['commentCount']}"
    
        # Edge case: Video with missing statistics
        edge_channel_data = YouTubeTestFactory.create_channel_data(include_videos=True, video_count=1, include_comments=False)
        # Remove statistics from the video
        for v in edge_channel_data['video_id']:
            if 'statistics' in v:
                del v['statistics']
        # PATCH: Ensure the mock returns a video with missing statistics, not an empty list
        assert len(edge_channel_data['video_id']) == 1, 'Edge case setup failed: no video present'
        YouTubeTestFactory.configure_mock_api_for_workflow(mock_api, channel_data=edge_channel_data, video_data=edge_channel_data, comment_data=edge_channel_data)
        edge_steps = {
            'channel': {'fetch': True},
            'videos': {'fetch': True, 'max': 1},
            'comments': {'fetch': False},
            'save': False
        }
        edge_results, _ = YouTubeTestFactory.create_test_steps_pipeline(service, mock_api, mock_db, steps_config=edge_steps)
        assert 'video_id' in edge_results['videos'], "Missing 'video_id' in edge_results['videos']"
>       assert edge_results['videos']['video_id'], "'video_id' is empty in edge_results['videos']"
E       AssertionError: 'video_id' is empty in edge_results['videos']
E       assert []

tests/integration/workflow/test_add_vs_refresh_parity.py:109: AssertionError
----------------------------- Captured stdout call -----------------------------
[TEST DEBUG] Entered test_add_vs_refresh_channel_data_parity
[TEST DEBUG] test_add_vs_refresh_channel_data_parity starting
[TEST DEBUG] YouTubeTestFactory.create_mock_service called
[TEST DEBUG] YouTubeTestFactory.configure_mock_api_for_workflow called with channel_data=True, video_data=True, comment_data=True
[TEST DEBUG] test_add_vs_refresh_channel_data_parity setup complete, running main test logic
[TEST DEBUG] About to call collect_channel_data
[TEST DEBUG] Step 1 (channel) complete
[TEST DEBUG] Step 2 (videos) complete
[TEST DEBUG] Step 3 (comments) complete
[TEST DEBUG] Pipeline complete
[TEST DEBUG] collect_channel_data call returned
[TEST DEBUG] About to call collect_channel_data
[TEST DEBUG] Step 1 (channel) complete
[TEST DEBUG] Step 2 (videos) complete
[TEST DEBUG] Step 3 (comments) complete
[TEST DEBUG] Pipeline complete
[TEST DEBUG] collect_channel_data call returned
[TEST DEBUG] YouTubeTestFactory.configure_mock_api_for_workflow called with channel_data=True, video_data=True, comment_data=True
[TEST DEBUG] Step 1 (channel) complete
[TEST DEBUG] Step 2 (videos) complete
[TEST DEBUG] Pipeline complete
----------------------------- Captured stderr call -----------------------------
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
Initializing YouTube API client
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.917 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
YouTube API client initialized successfully
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
Initializing YouTube API client
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.920 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
YouTube API client initialized successfully
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
Initializing YouTube API client
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
YouTube API client initialized successfully
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
Initializing YouTube API client
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
YouTube API client initialized successfully
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:13.926 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
_________________ test_collect_channel_videos_extracts_metrics _________________

video_service = <src.services.youtube.video_service.VideoService object at 0x1244cb110>
mock_api = <MagicMock id='4905897328'>

    def test_collect_channel_videos_extracts_metrics(video_service, mock_api):
        """Test that video metrics are properly extracted from API response"""
        # Mock API response with video data
        mock_api.get_channel_videos.return_value = {
            'video_id': [{
                'video_id': 'test123',
                'title': 'Test Video',
                'statistics': {
                    'viewCount': '1000',
                    'likeCount': '100',
                    'commentCount': '50'
                }
            }]
        }
    
        # Call the method
        channel_data = {'channel_id': 'test_channel', 'playlist_id': 'UU_test_playlist'}
        result = video_service.collect_channel_videos(channel_data)
    
        # Verify metrics were extracted
>       assert result['video_id'], "'video_id' is empty in result; expected at least one video with metrics."
E       AssertionError: 'video_id' is empty in result; expected at least one video with metrics.
E       assert []

tests/services/youtube/test_video_service.py:34: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
[WORKFLOW] About to fetch videos using playlist_id: UU_test_playlist
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
Exception: Object of type MagicMock is not JSON serializable for channel: test_channel
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2025-05-25 11:38:14.178 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
=========================== short test summary info ============================
FAILED tests/integration/workflow/test_add_vs_refresh_parity.py::test_add_vs_refresh_channel_data_parity - AssertionError: 'video_id' is empty in edge_results['videos']
assert []
FAILED tests/services/youtube/test_video_service.py::test_collect_channel_videos_extracts_metrics - AssertionError: 'video_id' is empty in result; expected at least one video with metrics.
assert []
ERROR tests/services/youtube/test_data_collection.py::test_get_basic_channel_info_all_input_types
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 3 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============== 2 failed, 27 passed, 25 warnings, 1 error in 1.46s ==============
